<!-- Modal -->
<div class="modal fade" id="export" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h4 class="modal-title">Export</h4>
			</div>
			<div class="modal-body">
        <p>Download your blocks in the XML format, so later you can restore them using the <a href="#import"  data-dismiss="modal" data-toggle="modal">Import tool</a>.</p>
				<textarea class="xmlcode"></textarea> <!-- @todo Make readonly?-->
				<a href="#" class="downXML">Download XML</a>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	$(document).ready(function () {
		$(document).on('show.bs.modal', function(event){
			if ($(event.target).attr('id') == 'export') {
				var xmlDom = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
				var xmlText = Blockly.Xml.domToPrettyText(xmlDom);
				$('#export .modal-body textarea').val(xmlText).focus();
			}
		});
		$('#export .modal-body .downXML').click(function() {
			EasyJ.Xml.download($('#export .modal-body textarea').val(), EasyJ.robotClass+".xml");
		})
	})
</script>